==============================================================================
                    AI CHATBOT ASSISTANT - SETUP & USAGE GUIDE
==============================================================================

OVERVIEW
--------
The AI Chatbot Assistant provides instant, intelligent support to farmers with:
‚úÖ Real-time question answering (weather, prices, farming advice)
‚úÖ Text AND audio responses in multiple Indian languages
‚úÖ Integration with OpenAI GPT or Google Gemini
‚úÖ Fallback to rule-based responses when AI is unavailable
‚úÖ Chat history management
‚úÖ Quick action buttons for common queries

==============================================================================
                        BACKEND SETUP
==============================================================================

1. INSTALL NEW DEPENDENCIES
---------------------------
cd frontend/backend
pip install -r requirements.txt

New packages installed:
- openai==1.6.1           # OpenAI GPT integration
- google-generativeai==0.3.2  # Google Gemini integration
- gTTS==2.5.0             # Text-to-Speech (Google TTS)
- pydub==0.25.1           # Audio processing


2. CONFIGURE API KEYS (.env file)
----------------------------------
Open: frontend/backend/.env

Add your API keys (at least ONE is required):

# Option 1: OpenAI (Recommended)
OPENAI_API_KEY=sk-your-openai-api-key-here

# Option 2: Google Gemini (Free alternative)
GEMINI_API_KEY=your-gemini-api-key-here

# Weather API (Optional - for real weather data)
WEATHER_API_KEY=your-openweathermap-api-key-here

HOW TO GET API KEYS:
-------------------
üîë OpenAI API Key:
   1. Go to: https://platform.openai.com/api-keys
   2. Create account / Sign in
   3. Click "Create new secret key"
   4. Copy and paste into .env file
   Cost: ~$0.002 per request (very cheap)

üîë Gemini API Key (FREE):
   1. Go to: https://makersuite.google.com/app/apikey
   2. Create account / Sign in
   3. Click "Create API Key"
   4. Copy and paste into .env file
   Cost: FREE (60 requests per minute)

üîë OpenWeatherMap API Key (Optional):
   1. Go to: https://openweathermap.org/api
   2. Sign up for free account
   3. Get API key from dashboard
   4. Copy and paste into .env file
   Cost: FREE for basic plan


3. START THE BACKEND
--------------------
cd frontend/backend
python run.py

Expected output:
‚úÖ Connected to MongoDB
‚úÖ Server starting on http://localhost:8000
‚úÖ AI Assistant initialized (using openai/gemini/fallback)

Verify at: http://localhost:8000/docs
New endpoints should appear:
- POST /api/chat/message
- GET /api/chat/history
- DELETE /api/chat/history
- POST /api/chat/quick-question

==============================================================================
                        FRONTEND SETUP
==============================================================================

1. START FRONTEND SERVER
------------------------
cd frontend
python -m http.server 3000

2. OPEN IN BROWSER
------------------
http://localhost:3000

3. YOU SHOULD SEE:
------------------
‚úÖ Green circular chatbot button at bottom-right corner
‚úÖ Click it to open the chat window
‚úÖ Quick action buttons: Weather, Prices, Pest, Disease

==============================================================================
                        HOW TO USE THE CHATBOT
==============================================================================

1. CLICK THE CHAT BUTTON
------------------------
- Green circular button at bottom-right
- Shows a chat icon
- Click to open chat window

2. ASK QUESTIONS
----------------
Type any farming question in your language:

ENGLISH EXAMPLES:
- "What is today's weather?"
- "What are the current rice prices?"
- "How do I control pests in tomatoes?"
- "My wheat crop has yellow leaves, what should I do?"
- "When is the best time to plant cotton?"

HINDI EXAMPLES:
- "‡§Ü‡§ú ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•à‡§∏‡§æ ‡§π‡•à?"
- "‡§ß‡§æ‡§® ‡§ï‡•Ä ‡§ï‡•Ä‡§Æ‡§§ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?"
- "‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•Ä‡§ü ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡•à‡§∏‡•á ‡§ï‡§∞‡•á‡§Ç?"

3. QUICK ACTIONS
----------------
Click the quick action buttons for instant responses:
‚òÄÔ∏è Today's Weather
üí∞ Market Prices
üêõ Pest Control
üåø Disease Help

4. AUDIO RESPONSES
------------------
- AI responds with BOTH text and audio
- Audio plays automatically
- Click "Play Audio" button to replay
- Supports all 6 Indian languages

5. CHAT HISTORY
---------------
- All conversations are saved
- View previous chats when you reopen
- Click "Clear chat" to delete history

==============================================================================
                        AI CHATBOT FEATURES
==============================================================================

INTELLIGENT RESPONSES
---------------------
‚úÖ Weather Queries: Real-time weather data from OpenWeatherMap
‚úÖ Market Prices: Live crop prices and trends
‚úÖ Pest Control: Specific treatment recommendations
‚úÖ Disease Diagnosis: Symptoms analysis and solutions
‚úÖ General Advice: Fertilizers, irrigation, crop management

MULTI-LANGUAGE SUPPORT
----------------------
‚úÖ English (en)
‚úÖ Hindi (hi)
‚úÖ Telugu (te)
‚úÖ Tamil (ta)
‚úÖ Bengali (bn)
‚úÖ Marathi (mr)

TEXT-TO-SPEECH
--------------
‚úÖ Responses converted to audio automatically
‚úÖ Natural voice in farmer's language
‚úÖ Audio files cached for faster playback
‚úÖ Works offline for repeated questions

CONTEXT AWARENESS
-----------------
‚úÖ Remembers user location
‚úÖ Considers crop type
‚úÖ Tracks conversation history
‚úÖ Provides personalized advice

==============================================================================
                        TROUBLESHOOTING
==============================================================================

ISSUE 1: CHATBOT BUTTON NOT APPEARING
--------------------------------------
Solution:
1. Check browser console (F12)
2. Verify ai-chatbot.js is loaded
3. Check for JavaScript errors
4. Ensure you're logged in

ISSUE 2: "AI SERVICE ERROR" MESSAGES
-------------------------------------
Solution:
1. Check if API key is set in .env
2. Verify API key is valid
3. Check internet connection
4. Look at backend logs for errors

If no API key:
- Chatbot will use rule-based fallback
- Still works but less intelligent
- Considers adding OpenAI/Gemini key

ISSUE 3: NO AUDIO PLAYBACK
---------------------------
Solution:
1. Check if gTTS is installed: pip install gTTS
2. Verify uploads/audio/tts directory exists
3. Check browser audio permissions
4. Look for TTS errors in backend logs

ISSUE 4: SLOW RESPONSES
------------------------
Possible causes:
- AI API latency (usually 2-5 seconds)
- Network issues
- Server overload

Solutions:
- Normal for AI responses
- Consider caching common questions
- Use fallback for instant responses

ISSUE 5: CHAT HISTORY NOT SAVING
---------------------------------
Solution:
1. Verify MongoDB is running
2. Check chat_history collection exists
3. Verify user is authenticated
4. Check backend logs for database errors

==============================================================================
                        CONFIGURATION OPTIONS
==============================================================================

CUSTOMIZE AI BEHAVIOR
---------------------
Edit: frontend/backend/app/services/ai_assistant.py

Change system prompt (Line 195):
- Adjust response style
- Add domain-specific knowledge
- Change tone and personality

CUSTOMIZE TTS VOICE
-------------------
Edit: frontend/backend/app/services/tts_service.py

Modify gTTS parameters:
- slow=True for slower speech
- lang codes for different accents
- Add custom TTS provider

CUSTOMIZE CHATBOT UI
--------------------
Edit: frontend/style.css (Lines 960-1349)

Modify:
- Chat window size and position
- Colors and styling
- Animation speeds
- Button styles

CUSTOMIZE QUICK ACTIONS
-----------------------
Edit: frontend/ai-chatbot.js (Lines 29-44)

Add/remove/modify quick action buttons:
- Change emojis
- Edit questions
- Add new categories

==============================================================================
                        TESTING THE CHATBOT
==============================================================================

TEST 1: BASIC CHAT
------------------
1. Open chat window
2. Type: "Hello"
3. Expected: Welcome message in your language

TEST 2: WEATHER QUERY
----------------------
1. Type: "What is today's weather?"
2. Expected: Temperature, humidity, conditions
3. Expected: Audio response plays automatically

TEST 3: MARKET PRICE QUERY
---------------------------
1. Type: "What is the rice price?"
2. Expected: Min/max/average prices
3. Expected: Market trend information

TEST 4: PEST CONTROL QUERY
---------------------------
1. Type: "How to control pests?"
2. Expected: Specific treatment steps
3. Expected: Organic and chemical options

TEST 5: LANGUAGE SWITCHING
---------------------------
1. Change language to Hindi
2. Type: "‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•à‡§∏‡§æ ‡§π‡•à?"
3. Expected: Response in Hindi
4. Expected: Hindi audio playback

TEST 6: CHAT HISTORY
---------------------
1. Send several messages
2. Close and reopen chat
3. Expected: Previous messages displayed
4. Click "Clear chat" to test deletion

==============================================================================
                        PRODUCTION DEPLOYMENT
==============================================================================

SECURITY CONSIDERATIONS
-----------------------
‚ö†Ô∏è Never commit API keys to Git
‚ö†Ô∏è Use environment variables
‚ö†Ô∏è Enable rate limiting for chat endpoint
‚ö†Ô∏è Implement abuse detection
‚ö†Ô∏è Add CAPTCHA for anonymous users

PERFORMANCE OPTIMIZATION
------------------------
‚úÖ Cache common responses in Redis
‚úÖ Implement request queuing
‚úÖ Pre-generate TTS for FAQ
‚úÖ Use CDN for audio files
‚úÖ Enable response compression

COST MANAGEMENT
---------------
üí∞ OpenAI: ~$0.002 per request
üí∞ Gemini: FREE (60 req/min)
üí∞ gTTS: FREE (unlimited)
üí∞ Storage: ~50MB per 1000 audio files

To reduce costs:
- Use Gemini instead of OpenAI
- Cache responses aggressively
- Implement daily usage limits
- Clean up old TTS files regularly

MONITORING
----------
Track these metrics:
- Average response time
- API error rate
- User satisfaction (thumbs up/down)
- Most asked questions
- Language usage distribution

==============================================================================
                        API ENDPOINTS REFERENCE
==============================================================================

POST /api/chat/message
----------------------
Send message to chatbot

Request:
{
  "message": "What is today's weather?",
  "language": "en",
  "include_audio": true,
  "context": {
    "location": "Pune"
  }
}

Response:
{
  "message": "Today's weather in Pune...",
  "audio_url": "/uploads/audio/tts/abc123.mp3",
  "data": { "temp": 28, "humidity": 65 },
  "type": "weather",
  "timestamp": "2024-01-15T10:30:00"
}

GET /api/chat/history?limit=20
-------------------------------
Get chat history

Response:
[
  {
    "id": "abc123",
    "user_message": "What is weather?",
    "bot_response": "Today's weather is...",
    "audio_url": "/uploads/audio/tts/xyz.mp3",
    "language": "en",
    "timestamp": "2024-01-15T10:30:00"
  }
]

DELETE /api/chat/history
-------------------------
Clear chat history

Response:
{
  "success": true,
  "message": "Deleted 15 chat messages"
}

==============================================================================
                        FUTURE ENHANCEMENTS
==============================================================================

PLANNED FEATURES
----------------
üîÆ Voice input for questions (speech-to-text)
üîÆ Image analysis in chat (send crop photos)
üîÆ Chat context awareness (remember previous questions)
üîÆ Suggested follow-up questions
üîÆ Farmer ratings for responses
üîÆ Export chat history as PDF
üîÆ Share responses via WhatsApp
üîÆ Offline mode with cached responses

ADVANCED AI FEATURES
--------------------
üîÆ Fine-tuned model on agricultural data
üîÆ Local language models (no API needed)
üîÆ Multi-modal responses (text + images + audio)
üîÆ Predictive suggestions
üîÆ Personalized recommendations based on farm data

==============================================================================
                        SUPPORT & CONTACT
==============================================================================

For issues or questions:
1. Check backend logs: frontend/backend/logs/app.log
2. Check browser console (F12)
3. Review this guide thoroughly
4. Check API provider status pages

Common Log Locations:
- Backend: Terminal where you ran `python run.py`
- Frontend: Browser DevTools Console (F12)
- MongoDB: mongod.log

==============================================================================
                        QUICK REFERENCE
==============================================================================

START BACKEND:
cd frontend/backend && python run.py

START FRONTEND:
cd frontend && python -m http.server 3000

INSTALL DEPS:
pip install -r requirements.txt

CHECK API:
http://localhost:8000/docs

OPEN APP:
http://localhost:3000

CHAT LOCATION:
Bottom-right green button

API KEYS NEEDED:
- OpenAI OR Gemini (choose one)
- OpenWeatherMap (optional)

FILES CREATED:
‚úÖ backend/app/services/ai_assistant.py (418 lines)
‚úÖ backend/app/services/tts_service.py (121 lines)
‚úÖ backend/app/routes/chatbot.py (209 lines)
‚úÖ frontend/ai-chatbot.js (478 lines)
‚úÖ frontend/style.css (+402 lines for chat UI)

DATABASE:
- New collection: chat_history
- Stores all conversations

COST:
- OpenAI: ~$0.002/request
- Gemini: FREE
- Storage: Minimal

==============================================================================
                            SUCCESS!
==============================================================================

Your AI Chatbot Assistant is now fully integrated! üéâ

Farmers can now:
‚úÖ Ask questions 24/7
‚úÖ Get instant intelligent responses
‚úÖ Hear answers in their language
‚úÖ Access weather and market data
‚úÖ Get farming advice immediately

No more waiting for officer responses for common questions!
